# install Fabric-camel + camel example in 2.2.1 or later of Apache Karaf

features:addurl mvn:org.fusesource.fabric/fabric-distro/1.0-SNAPSHOT/xml/features

features:install fabric-commands
shell:echo Waiting a couple of seconds for the fabric-commands to start
shell:sleep 5000

fabric:zk-cluster root
shell:echo Waiting a couple of seconds for the zookeeper server to start
shell:sleep 5000

shell:echo Installing camel features repository and deploy camel
features:addurl mvn:org.apache.camel.karaf/apache-camel/2.7.0/xml/features
features:install camel
shell:sleep 5000

shell:echo Installing camel fabric demo features repository and deploy camel-master
features:addurl mvn:org.fusesource.fabric.examples.fabric-camel-master-slave/features/1.0-SNAPSHOT/xml/features
features:install camel-slave
shell:sleep 5000

shell:echo Create fabric profile 
fabric:create-profile --parents default fabric-test

shell:echo add repositories, features to be deployed in the store
zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/repository.camel mvn:org.apache.camel.karaf/apache-camel/2.7.0/xml/features
zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/feature.camel camel 
zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/feature.camel-blueprint camel-blueprint
zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/repository.fabric-camel-test mvn:org.fusesource.fabric.examples.fabric-camel-master-slave/features/1.0-SNAPSHOT/xml/features
zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/feature.fabric-camel-test camel-master

#zk:create -r /fabric/configs/versions/base/profiles/fabric-test/org.fusesource.fabric.agent/pid/uri fabric:test:jetty:http://0.0.0.0:${portNumber}


fabric:create-profile --parents fabric-test fabric-test-port-9090
zk:create -r /fabric/configs/versions/base/profiles/fabric-test-port-9090/fabricCamel/portNumber 9090


fabric:create-profile --parents fabric-test fabric-test-port-9191
zk:create -r /fabric/configs/versions/base/profiles/fabric-test-port-9191/fabricCamel/portNumber 9191

shell:echo Create fabric agent 
fabric:create-agent --profile fabric-test-port-9090 --parent root zk-9090
fabric:create-agent --profile fabric-test-port-9191 --parent root zk-9191
shell:sleep 1000

