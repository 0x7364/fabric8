INTRODUCTION
============

This example demonstrates the provisioning feature of fuseSource Fabric based on profiles
defined in zookeeper configuration registry and how we can use the fabric-camel component in
a cluster environment.  We will deploy a fabric camel route on one karaf instance

    <route id="fabric-slave">
      <from uri="timer://foo?fixedRate=true&amp;period=10000"/>
      <setBody>
          <simple>Hello from Zookeeper server</simple>
      </setBody>
      <to uri="fabric:cheese"/>
      <log message=">>> ${body} : ${header.karaf.name}"/>
    </route>

and sends messages to a fabric called cheese while two other fabric camel routes deployed on zookeeper
agents and exposing HTTP Servers will be able to answer to the client.

     <route id="fabric-server">
        <from uri="fabric:cheese:jetty:http://0.0.0.0:{{portNumber}}/fabric"/>
        <log message="Request received : ${body}"/>
        <setHeader headerName="karaf.name">
            <simple>${sys.karaf.name}</simple>
        </setHeader>
        <transform>
            <simple>Response from Zookeeper agent</simple>
        </transform>
     </route>

Additionally, the loadbalancing mechanism of fabric camel will be displayed as the response will come randomly
from one of the instance configured

COMPILING
=========
cd fabric-examples/fabric-camel-cluster-loadbalancing
mvn clean install

RUNNING
=======
1) Before you run Karaf you might like to set these environment variables...

    export JAVA_PERM_MEM=64m
    export JAVA_MAX_PERM_MEM=512m


2) Download and install a fresh version of Karaf 2.2.x from Fuse repo http://repo.fusesource.com/nexus/content/repositories/releases/org/apache/karaf/apache-karaf/

3) Check FuseSource maven repo

Make sure you have

    http://repo.fusesource.com/nexus/content/repositories/releases,
    http://scala-tools.org/repo-releases/

added to org.ops4j.pax.url.mvn.repositories property in etc/org.ops4j.pax.url.mvn.cfg file.

4) Next start karaf with command bin/karaf or bin/karaf.bat

And run the following command in the console

    shell:source mvn:org.fusesource.fabric.fabric-examples.fabric-camel-dosgi/features/1.1-SNAPSHOT/karaf/installer

If you want to modify the script before sourcing it, you can find it in the Fabric examples source at ${FABRIC_HOME}/fabric-examples/etc/install-fabric-dosgi-camel.karaf
So you can source it directly using the following command

    shell:source file:///${FABRIC_HOME}/target/classes/distro/etc/install-fabric-dosgi-camel.karaf



